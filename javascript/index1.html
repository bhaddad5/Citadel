<!DOCTYPE html>
<html>
  <head>
    <title>Putting in Basics</title>
  </head>
  <body>
   <script src="js/three.min.js"></script>
   <script src='js/THREEx.KeyboardState.js'></script>
   
 <script>
  
  //This is the core of the game.  Bow before its awesome might!
  var Game = function() {};
  
  //This creates some global variables
  var time0 = new Date().getTime();
  var camera, scene, renderer, light;
  
  //This creates the keyboard
  var keyboard = new THREEx.KeyboardState();
  
  //these booleans keep track of whether a key is pressed
  var wPres = false;
  var aPres = false;
  var sPres = false;
  var dPres = false;
  
  //These booleans keep track of which directions the robot can move
  var canMoveW = false;
  var canMoveS = false;
  var canMoveA = false;
  var canMoveD = false;
  

  //Name: converter
  //This converts the position on the board to the position in the world
  var converter = function(boardPos) {
    return {x: boardPos.x * 100 - 350, y: boardPos.y * 100 - 350, z:0};
  };
  
  
  //Name: Wall
  //This is a wall the player cannot pass through
  var Wall = function(position) {
    //A Wall is a game object
	//It's default position is the origin
	position = position || {x:0, y:0};
	this.type = 'Wall';
	
	//This creates the red cube
	this.geometry = new THREE.CubeGeometry(90, 90, 90);
	this.material = new THREE.MeshLambertMaterial({color: 0xff0000});
	this.object = new THREE.Mesh(this.geometry, this.material);
	
	//This changes it to the correct position
	this.object.position = converter(position);
	
	    console.log(position);
  };
    
	
  //Name: Robot
  //This is the main player Robot
  var Robot = function(position) {
    //A Robot is a game object
	//It's default position is the origin
	this.position = position || {x:0, y:0};
	this.type = 'Robot';
	
	//This creates the blue circle
	this.geometry = new THREE.SphereGeometry(45, 20, 20);
	this.material = new THREE.MeshLambertMaterial({color: 0x0000ff});
	this.object = new THREE.Mesh(this.geometry, this.material);
	
	//This changes it to the correct position
	this.object.position = converter(this.position);
	
	    console.log("Robot at:");
	    console.log(this.position);
  };

  
  //Name: Robot.prototype.updatePos
  //This updates the Robot's Position
  Robot.prototype.updatePos = function(position) {
    this.position = position;
	this.object.position = converter(this.position);
  };
  
  
  //Name: Robot.prototype.canMoveW
  //This checks if the robot can move up
  Robot.prototype.canMove = function() {
    
	//This checks if the robot can move up
	if(this.position.y < 7) {
	  canMoveW = true;
	}
	if(this.position.y >= 7) {
	  canMoveW = false;
	}
	
	//This checks if the robot can move down
	if(this.position.y > 0) {
	  canMoveS = true;
	}
	if(this.position.y <= 0) {
	  canMoveS = false;
	}
	
	//This checks if the robot can move left
	if(this.position.x > 0) {
	  canMoveA = true;
	}
	if(this.position.x <= 0) {
	  canMoveA = false;
	}
	
	//This checks if the robot can move right
	if(this.position.x < 7) {
	  canMoveD = true;
	}
	if(this.position.x >= 7) {
	  canMoveD = false;
	}
  }
  
  
  //Name: Initialize
  //This function creates and renders everything. 
  Game.prototype.initialize = function() {
  
	//This creates the camera.  I used your numbers in lieu of better ones.
	camera = new THREE.PerspectiveCamera(75,4.0/3.0, 1, 10000);
	camera.position.z = 1000;
	
	//This creates the scene.
	scene = new THREE.Scene();
	
	//This adds the background plane
	var backGeometry = new THREE.PlaneGeometry(800, 800);
	var backMaterial = new THREE.MeshLambertMaterial();
	var background = new THREE.Mesh(backGeometry, backMaterial);
	background.translateZ(-50);
	scene.add(background);
	
	//This adds the walls to the data structure
	var walls = new Array();
	walls.push(new Wall({x:0, y:1}));
	walls.push(new Wall({x:1, y:0,}));
	walls.push(new Wall({x:1, y:1}));
	walls.push(new Wall({x:0, y:2}));
	
	//This adds the walls to the scene
	for(var i = 0; i<walls.length; i++) {
	  scene.add(walls[i].object);
	};
	
	this.robot = new Robot({x:2, y:0});
	scene.add(this.robot.object);
	
	//This creates and adds the light.  I used your numbers in lieu of better ones.
    this.light = new THREE.PointLight(0xffffff, 1, 1000);
    this.light.position.set(0, -100, 300);
    scene.add(this.light);
	
	//This creates the renderer.  I used your numbers in lieu of better ones.
	renderer = new THREE.WebGLRenderer({antialias: true});
	renderer.setSize(800,600);
	renderer.setClearColor(0xeeeeee, 1.0);
	document.body.appendChild(renderer.domElement);
  };
  
  //Name: Game.prototype.handleInput
  //This checks if the robot can move and does so
  Game.prototype.handleInput = function() {
    //This checks which directions the robot can move
	this.robot.canMove();
    
    //These will move the robot once the moment they are pressed
	if(keyboard.pressed("W") && wPres == false && canMoveW == true) {
	  this.robot.updatePos({x: this.robot.position.x, y: this.robot.position.y +1});
	  wPres = true;
	};
	if(keyboard.pressed("S") && sPres == false && canMoveS == true) {
	  this.robot.updatePos({x: this.robot.position.x, y: this.robot.position.y -1});
	  sPres = true;
	};
	if(keyboard.pressed("A") && aPres == false && canMoveA == true) {
	  this.robot.updatePos({x: this.robot.position.x -1, y: this.robot.position.y});
	  aPres = true;
	};
	if(keyboard.pressed("D") && dPres == false && canMoveD == true) {
	  this.robot.updatePos({x: this.robot.position.x +1, y: this.robot.position.y});
	  dPres = true;
	};
	
	//These will reset the key's states the moment they are released
	if(!(keyboard.pressed("W")) && wPres == true) {
	  wPres = false;
	};
	if(!(keyboard.pressed("S")) && sPres == true) {
	  sPres = false;
	};
	if(!(keyboard.pressed("A")) && aPres == true) {
	  aPres = false;
	};
	if(!(keyboard.pressed("D")) && dPres == true) {
	  dPres = false;
	};
  };
  
  //Name: render
  //This renders the scene
  function render(t) {
    // Bob the camera a bit
    camera.position.x = Math.sin(t / 1000.0) * 60;
    camera.position.y = -1000 + Math.sin(t / 700.0) * 40;
    camera.lookAt(scene.position);
    renderer.render(scene, camera);
  };
  
  
  //Name: animate
  //This animates the scene
  Game.prototype.animate = function() {
    //This tells the game to check the input
    game.handleInput();
	
    //this loops through, animating the scene
    requestAnimationFrame( game.animate);
	
    var time = new Date().getTime();
    render(time - time0);

  };
  
  game = new Game();
  
  game.initialize();
  game.animate();

</script>   
   
  </body>
</html>